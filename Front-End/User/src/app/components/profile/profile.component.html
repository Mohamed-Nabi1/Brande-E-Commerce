<div class="profile-edit-container" *ngIf="customer">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="card profile-card">
          <div class="card-header">
            <h4 class="mb-0"><i class="fas fa-user-edit me-2"></i>Edit Profile</h4>
          </div>
          <div class="card-body p-4">
            <form class="row g-3" [formGroup]="validFrm" (ngSubmit)="
              UpdateCustomer(
                fname.value,
                mname.value,
                lname.value,
                phonenumber.value,
                email.value,
                city.value,
                country.value,
                street.value,
                password.value
              )">

              <!-- Personal Information Section -->
              <div class="col-12 mb-4">
                <h5 class="border-bottom pb-2"><i class="fas fa-user-circle me-2"></i>Personal Information</h5>
              </div>

              <!-- Name Fields -->
              <div class="col-md-4 mb-3">
                <div class="form-floating">
                  <input #fname [(ngModel)]="customer.firstName" formControlName="fname"
                    (keypress)="keyPressMinLength($event, 15)" type="text" class="form-control" id="fname"
                    placeholder="First Name" required>
                  <label for="fname">First name</label>
                  <div class="invalid-feedback d-block"
                    *ngIf="validFrm.get('fname')?.errors && (validFrm.get('fname')?.dirty || validFrm.get('fname')?.touched)">
                    <span *ngIf="validFrm?.get('fname')?.errors?.['required']">First name is required</span>
                    <span *ngIf="validFrm?.get('fname')?.errors?.['minlength']">First name must be more than 3 letters</span>
                  </div>
                </div>
              </div>

              <div class="col-md-4 mb-3">
                <div class="form-floating">
                  <input #mname [(ngModel)]="customer.midName" formControlName="mname"
                    (keypress)="keyPressMinLength($event, 15)" type="text" class="form-control" id="mname"
                    placeholder="Middle Name">
                  <label for="mname">Middle name</label>
                </div>
              </div>

              <div class="col-md-4 mb-3">
                <div class="form-floating">
                  <input #lname [(ngModel)]="customer.lastName" formControlName="lname"
                    (keypress)="keyPressMinLength($event, 15)" type="text" class="form-control" id="lname"
                    placeholder="Last name" required>
                  <label for="lname">Last name</label>
                  <div class="invalid-feedback d-block"
                    *ngIf="validFrm.get('lname')?.errors && (validFrm.get('lname')?.dirty || validFrm.get('lname')?.touched)">
                    <span *ngIf="validFrm?.get('lname')?.errors?.['required']">Last name is required</span>
                    <span *ngIf="validFrm?.get('lname')?.errors?.['minlength']">Last name must be more than 3 letters</span>
                  </div>
                </div>
              </div>

              <!-- Contact Information -->
              <div class="col-md-6 mb-3">
                <div class="form-floating">
                  <input #phonenumber [(ngModel)]="customer.phoneNumber" formControlName="phonenumber"
                    (keypress)="keyPressNumbers($event, 25)" type="text" class="form-control" id="phonenumber"
                    placeholder="Phone number" required>
                  <label for="phonenumber">Phone number</label>
                  <div class="invalid-feedback d-block"
                    *ngIf="validFrm.get('phonenumber')?.errors && (validFrm.get('phonenumber')?.dirty || validFrm.get('phonenumber')?.touched)">
                    <span *ngIf="validFrm?.get('phonenumber')?.errors?.['required']">Phone number is required</span>
                    <span *ngIf="validFrm?.get('phonenumber')?.errors?.['minlength']">Phone number must be more than 8 digits</span>
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="form-floating">
                  <input #email [(ngModel)]="customer.email" formControlName="email"
                    (keypress)="keyPressMinLength($event, 35)" type="email" class="form-control" id="email"
                    placeholder="Email" required>
                  <label for="email">Email</label>
                  <div class="invalid-feedback d-block"
                    *ngIf="validFrm.get('email')?.errors && (validFrm.get('email')?.dirty || validFrm.get('email')?.touched)">
                    <span *ngIf="validFrm?.get('email')?.errors?.['required']">Email is required</span>
                    <span *ngIf="validFrm?.get('email')?.errors?.['pattern']">Invalid email format</span>
                  </div>
                </div>
              </div>

              <!-- Address Section -->
              <div class="col-12 mb-4 mt-4">
                <h5 class="border-bottom pb-2"><i class="fas fa-map-marker-alt me-2"></i>Address Information</h5>
              </div>

              <div class="col-md-4 mb-3">
                <div class="form-floating">
                  <select #country [(ngModel)]="customer.country" formControlName="country" class="form-select"
                    id="country" required>
                    <option *ngFor="let country of Countries" [value]="country">
                      {{ country }}
                    </option>
                  </select>
                  <label for="country">Country</label>
                  <div class="invalid-feedback d-block"
                    *ngIf="validFrm.get('country')?.errors && (validFrm.get('country')?.dirty || validFrm.get('country')?.touched)">
                    <span *ngIf="validFrm?.get('country')?.errors?.['required']">Country is required</span>
                  </div>
                </div>
              </div>

              <div class="col-md-4 mb-3">
                <div class="form-floating">
                  <input #city [(ngModel)]="customer.city" formControlName="city"
                    (keypress)="keyPressMinLength($event, 15)" type="text" class="form-control" id="city"
                    placeholder="City" required>
                  <label for="city">City</label>
                  <div class="invalid-feedback d-block"
                    *ngIf="validFrm.get('city')?.errors && (validFrm.get('city')?.dirty || validFrm.get('city')?.touched)">
                    <span *ngIf="validFrm?.get('city')?.errors?.['required']">City is required</span>
                    <span *ngIf="validFrm?.get('city')?.errors?.['minlength']">City must be more than 3 letters</span>
                  </div>
                </div>
              </div>

              <div class="col-md-4 mb-3">
                <div class="form-floating">
                  <input #street [(ngModel)]="customer.street" formControlName="street"
                    (keypress)="keyPressMinLength($event, 20)" type="text" class="form-control" id="street"
                    placeholder="Street" required>
                  <label for="street">Street</label>
                  <div class="invalid-feedback d-block"
                    *ngIf="validFrm.get('street')?.errors && (validFrm.get('street')?.dirty || validFrm.get('street')?.touched)">
                    <span *ngIf="validFrm?.get('street')?.errors?.['required']">Street is required</span>
                    <span *ngIf="validFrm?.get('street')?.errors?.['minlength']">Street must be more than 3 letters</span>
                  </div>
                </div>
              </div>

              <!-- Security Section -->
              <div class="col-12 mb-4 mt-4">
                <h5 class="border-bottom pb-2"><i class="fas fa-lock me-2"></i>Security</h5>
              </div>

              <div class="col-md-6 mb-3">
                <div class="input-group">
                  <div class="form-floating flex-grow-1">
                    <input #password formControlName="password" (keypress)="keyPressMinLength($event, 50)"
                      type="{{ showPassword ? 'text' : 'password' }}" class="form-control" id="password"
                      placeholder="Password" required>
                    <label for="password">Password</label>
                  </div>
                  <span class="input-group-text" (click)="togglePassword()">
                    <i [ngClass]="showPassword ? 'fa fa-eye':'fa fa-eye-slash'"></i>
                  </span>
                </div>
                <div class="invalid-feedback d-block"
                  *ngIf="validFrm.get('password')?.errors && (validFrm.get('password')?.dirty || validFrm.get('password')?.touched)">
                  <span *ngIf="validFrm?.get('password')?.errors?.['required']">Password is required</span>
                  <span *ngIf="validFrm?.get('password')?.errors?.['minlength']">Password must be at least 8 characters</span>
                </div>
              </div>

              <!-- Submit Button -->
              <div class="col-12 mt-4 text-center">
                <button type="submit" class="btn btn-update">
                  <i class="fas fa-save me-2"></i>Save Changes
                </button>
                <a routerLink="/profileInfo" class="btn btn-outline-secondary ms-2">
                  <i class="fas fa-times me-2"></i>Cancel
                </a>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Alert Modal -->
<div class="modal fade show" tabindex="-1" role="dialog" [ngClass]="displayAlert">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i [ngClass]="FlagError ? 'fas fa-exclamation-triangle text-warning me-2' : 'fas fa-check-circle text-success me-2'"></i>
          {{ FlagError ? "Alert" : "Success" }}
        </h5>
        <button type="button" class="btn-close" (click)="closePopup()" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>{{ message }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn" [ngClass]="FlagError ? 'btn-warning' : 'btn-success'" (click)="closePopup()">
          <i class="fas fa-times me-2"></i>Close
        </button>
      </div>
    </div>
  </div>
</div>